# Ecosia Customizations Tracking

**Purpose:** Document all Firefox code modifications for Ecosia during version upgrades.  
**Last Updated:** December 2025  
**Status:** Phase 1 Complete - Tuist Integration Ready

---

## Summary

- **Total Files with Modifications:** 110
- **Total `// Ecosia:` Comments:** 395
- **Most Modified Areas:** UI (browser, menu, homepage, toolbar)
- **Primary Changes:** Feature flags, search providers, analytics, UI customization

---

## Top 20 Most Modified Files

| File | # Changes | Category |
|------|-----------|----------|
| `Client/Frontend/Browser/MainMenuActionHelper.swift` | 30 | Menu Actions |
| `firefox-ios-tests/Tests/ClientTests/Coordinators/RouteTests.swift` | 28 | Tests |
| `Client/Frontend/Toolbar+URLBar/URLBarView.swift` | 24 | URL Bar UI |
| `firefox-ios-tests/Tests/ClientTests/TabManagement/TabManagerTests.swift` | 17 | Tests |
| `Client/Frontend/Home/LegacyHomepageViewController.swift` | 17 | Homepage |
| `Client/Frontend/Browser/BrowserViewController/Views/BrowserViewController.swift` | 16 | Browser UI |
| `Client/Frontend/Home/HomepageViewModel.swift` | 14 | Homepage Logic |
| `Client/Frontend/Browser/ButtonToast.swift` | 14 | Toast UI |
| `Client/Frontend/Library/Bookmarks/Legacy/LegacyBookmarksPanel.swift` | 12 | Bookmarks |
| `Client/Frontend/Browser/Search/SearchViewController.swift` | 11 | Search UI |
| `Client/Application/AppDelegate.swift` | 11 | App Init |
| `Shared/UserAgent.swift` | 8 | User Agent |
| `firefox-ios-tests/Tests/ClientTests/Coordinators/URLScannerTests.swift` | 7 | Tests |
| `Client/Frontend/Settings/SettingsTableViewController.swift` | 7 | Settings |
| `Client/Frontend/Toolbar+URLBar/TabToolbar.swift` | 6 | Toolbar |
| `Client/Frontend/Library/HistoryPanel/HistoryPanel.swift` | 6 | History |
| `Client/Frontend/Home/HomepageContextMenuHelper.swift` | 6 | Homepage Context |
| `Client/Coordinators/Browser/BrowserCoordinator.swift` | 6 | Browser Coordinator |
| `firefox-ios-tests/Tests/ClientTests/Frontend/Home/TopSites/TopSitesDimensionTests.swift` | 5 | Tests |
| `Client/Frontend/Home/TopSites/TopSitesViewModel.swift` | 5 | Top Sites |

---

## Customization Categories

### 1. **Browser UI/UX (100+ changes)**
- Menu actions customization
- URL bar behavior
- Toast notifications
- Search presentation
- Button styling

**Files:**
- `Client/Frontend/Browser/MainMenuActionHelper.swift`
- `Client/Frontend/Toolbar+URLBar/URLBarView.swift`
- `Client/Frontend/Browser/BrowserViewController/Views/BrowserViewController.swift`
- `Client/Frontend/Browser/ButtonToast.swift`
- `Client/Frontend/Browser/Search/SearchViewController.swift`

### 2. **Homepage (40+ changes)**
- Top sites display
- Homepage sections
- Context menu items
- View model logic

**Files:**
- `Client/Frontend/Home/LegacyHomepageViewController.swift`
- `Client/Frontend/Home/HomepageViewModel.swift`
- `Client/Frontend/Home/HomepageContextMenuHelper.swift`
- `Client/Frontend/Home/TopSites/TopSitesViewModel.swift`
- `Client/Frontend/Home/CustomizeHome/CustomizeHomepageSectionViewModel.swift`

### 3. **Settings & Configuration (25+ changes)**
- Search provider defaults
- Settings tabs
- User preferences

**Files:**
- `Client/Frontend/Settings/SettingsTableViewController.swift`
- `Client/Frontend/Settings/Main/AppSettingsTableViewController.swift`
- `Client/Frontend/Settings/SearchBar/SearchBarSettingsViewModel.swift`

### 4. **Application Initialization (15+ changes)**
- Launch sequence
- Feature flags
- Service initialization

**Files:**
- `Client/Application/AppDelegate.swift`
- `Client/Application/AppLaunchUtil.swift`

### 5. **Core Libraries (20+ changes)**
- User agent customization
- Bookmarks handling
- Tab management

**Files:**
- `Shared/UserAgent.swift`
- `Client/Frontend/Library/Bookmarks/Legacy/LegacyBookmarksPanel.swift`
- `Client/Frontend/Library/Bookmarks/Legacy/BookmarksPanelViewModel.swift`
- `Client/TabManagement/Tab.swift`
- `Client/TabManagement/Legacy/LegacyTabManager.swift`

### 6. **Coordinators & Navigation (15+ changes)**
- Route handling
- Browser flow coordination
- Scanner logic

**Files:**
- `Client/Coordinators/Browser/BrowserCoordinator.swift`
- `Client/Coordinators/SettingsCoordinator.swift`
- `Client/Coordinators/Router/RouteBuilder.swift`

### 7. **Test Files (60+ changes)**
- Route tests
- Tab manager tests
- URL scanner tests
- Coordinate tests

**Files:**
- `firefox-ios-tests/Tests/ClientTests/Coordinators/RouteTests.swift`
- `firefox-ios-tests/Tests/ClientTests/TabManagement/TabManagerTests.swift`
- `firefox-ios-tests/Tests/ClientTests/Coordinators/URLScannerTests.swift`
- `firefox-ios-tests/Tests/ClientTests/Coordinators/SettingsCoordinatorTests.swift`

### 8. **Analytics & Telemetry (10+ changes)**
- Event tracking
- Analytics setup

**Files:**
- `Client/Frontend/Settings/Clearables.swift`
- `Client/Frontend/Browser/BrowserViewController/Extensions/BrowserViewController+TabToolbarDelegate.swift`

---

## Key Integration Points

### Search Provider Injection
- Default search provider set to Ecosia
- Search controller customization
- Query parameter modification

### Analytics Instrumentation
- All events tracked through `Analytics.shared`
- Custom event types defined in `Ecosia/Analytics/Analytics.Values.swift`
- Implementations at UI/ViewModel layer (per standards)

### UI Theme & Branding
- Custom colors and assets
- Logo replacement
- Toolbar styling
- Toast styling

### Feature Flags
- Ecosia-specific features gated
- Firefox features conditionally disabled
- A/B testing support

---

## Firefox Upgrade Process Notes

### Important Files to Monitor During Upgrades

**High Priority (breaking changes likely):**
- `Client/Application/AppDelegate.swift` - App initialization
- `Client/Application/AppLaunchUtil.swift` - Launch utilities
- `Client/Coordinators/Browser/BrowserCoordinator.swift` - Navigation structure
- `Client/Frontend/Browser/BrowserViewController/Views/BrowserViewController.swift` - Core UI

**Medium Priority (API changes likely):**
- `Client/Frontend/Home/HomepageViewModel.swift` - Homepage layout
- `Client/Frontend/Settings/SettingsTableViewController.swift` - Settings structure
- `Client/TabManagement/Tab.swift` - Tab handling

**Low Priority (mostly compatible):**
- Test files (usually backwards compatible with new tests added)
- Utility functions (`Shared/UserAgent.swift`)
- View extensions and helpers

### Merge Conflict Strategy

**For `.swift` files with Ecosia modifications:**
1. Use `git merge-tool` or manual review
2. Look for `// Ecosia:` comments to identify customizations
3. Preserve both Firefox changes AND Ecosia modifications
4. Test integration immediately after merge

**For files with many changes:**
- Consider side-by-side comparison
- Use semantic merge tools if available
- Test affected features thoroughly

---

## Testing Checklist Post-Upgrade

- [ ] App launches successfully
- [ ] Search defaults to Ecosia
- [ ] Homepage displays correctly
- [ ] Menu actions work as expected
- [ ] Settings display all customizations
- [ ] Analytics events fire correctly
- [ ] Extensions (Share, Widget) function properly
- [ ] Build completes without errors
- [ ] All unit tests pass
- [ ] UI tests pass

---

## Files by Directory

### Client/Application/ (15 files modified)
- AppDelegate.swift
- AppLaunchUtil.swift
- AccessibilityIdentifiers.swift
- QuickActions.swift

### Client/Frontend/Browser/ (60+ files modified)
- BrowserViewController (multiple extensions)
- MainMenuActionHelper.swift
- Search components
- Toast notifications
- Tab toolbar
- URL bar

### Client/Frontend/Home/ (25+ files modified)
- HomepageViewController variants
- HomepageViewModel
- TopSites components
- CustomizeHome components
- ContextMenu helpers

### Client/Frontend/Settings/ (12+ files modified)
- SettingsTableViewController
- AppSettingsTableViewController
- ClearPrivateData
- SearchBar components
- Clearables

### Client/Frontend/Library/ (15+ files modified)
- Bookmarks (Legacy)
- History panel
- Downloads panel
- Reader panel

### Shared/ (8 files modified)
- UserAgent.swift
- AppInfo.swift
- AppConstants.swift

### firefox-ios-tests/ (70+ files modified)
- Route tests
- Tab manager tests
- Coordinator tests
- URL scanner tests
- Top sites tests

---

## Notes for Development Team

1. **Separation of Concerns:** Ecosia customizations are clearly marked with `// Ecosia:` comments. This makes merges clearer.

2. **Framework vs Implementation:** Core Ecosia-specific code is in `Ecosia/` directory (framework). Firefox code modifications are localized with comments.

3. **Code Review Focus:** During code reviews, specifically check:
   - Search provider defaults
   - Menu action ordering
   - Analytics event tracking
   - Homepage layout

4. **Testing Impact:** Ecosia modifications affect:
   - Search functionality (100% coverage)
   - Menu actions (100% coverage)
   - Analytics (unit + integration tests)
   - UI layout (visual regression tests)

5. **Performance Considerations:**
   - No performance-critical customizations found
   - All changes maintain parity with Firefox baseline
   - Analytics overhead is minimal

---

## Historical Tracking

### Firefox v145.3 â†’ Current (Tuist Integration)
- Baseline established
- All customizations documented
- Ready for upgrade testing

### Future Upgrades
- Use this document as reference
- Track new files that appear in Firefox updates
- Update category counts after each upgrade

---

## Related Documentation

- See `Ecosia/` directory for Ecosia-specific implementation
- See `Tuist/` directory for build system configuration
- See `TUIST_RISK_ASSESSMENT_VALIDATION.md` for Phase 1 findings

